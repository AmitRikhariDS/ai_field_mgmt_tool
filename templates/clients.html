<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Clients - AI Field Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container mt-4">
    <h2 class="mb-3">Clients</h2>

    <!-- Add Client Form -->
    <form id="clientForm" class="row g-3 mb-4">
      <div class="col-md-4">
        <input type="text" class="form-control" id="clientName" placeholder="Client Name" required>
      </div>
      <div class="col-md-6">
        <input type="text" class="form-control" id="clientAddress" placeholder="Client Address">
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">Add</button>
      </div>
    </form>

    <!-- Clients Table -->
    <div class="card">
      <div class="card-header bg-white"><h5 class="mb-0">All Clients</h5></div>
      <div class="card-body p-0">
        <table class="table table-striped table-hover mb-0" id="clientsTable">
          <thead class="table-light">
            <tr>
              <th>ID</th><th>Name</th><th>Address</th><th>Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const clientsTable = document.querySelector("#clientsTable tbody");

  // Load Clients
  function loadClients() {
    fetch("/api/clients/")
      .then(res => res.json())
      .then(data => {
        clientsTable.innerHTML = "";
        data.forEach(client => {
          clientsTable.innerHTML += `
            <tr>
              <td>${client.id}</td>
              <td>${client.name}</td>
              <td>${client.address || "-"}</td>
              <td><button class="btn btn-sm btn-danger" onclick="deleteClient(${client.id})">Delete</button></td>
            </tr>`;
        });
      })
      .catch(err => console.error("Error loading clients:", err));
  }

  // Add Client
document.querySelector("#clientForm").addEventListener("submit", e => {
  e.preventDefault();
  const payload = {
    name: document.querySelector("#clientName").value,
    address: document.querySelector("#clientAddress").value
  };

  fetch("/api/clients/", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(res => {
    if (!res.ok) {
      return res.json().then(err => { throw new Error(JSON.stringify(err)); });
    }
    return res.json();
  })
  .then(() => {
    document.querySelector("#clientForm").reset();
    loadClients();   // âœ… refresh the list after adding
  })
  .catch(err => {
    alert("Error adding client: " + err.message);
    console.error("Client add error:", err);
  });
});

  // Delete Client
  window.deleteClient = function(id) {
    if (!confirm("Delete this client?")) return;
    fetch("/api/clients/" + id + "/", { method: "DELETE" })
      .then(() => loadClients());
  };

  // Init
  loadClients();
});
</script>
</body>
</html>
